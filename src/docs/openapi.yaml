openapi: 3.0.3
info:
  title: Flower Shop API
  version: 1.0.0
  description: |-
    API for the FlowerApplication backend. Supports versioned routes under /api/v1.
servers:
  - url: /api/v1
    description: Versioned API
  - url: /api
    description: Legacy alias (same routes as v1)

tags:
  - name: Auth
  - name: Flowers
  - name: Orders
  - name: Categories
  - name: Cities
  - name: Promotions
  - name: Users

paths:
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Registered user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Authenticated user and token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /categories:
    get:
      tags: [Categories]
      summary: List categories
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Sort"
      responses:
        "200":
          description: Category list
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/Category"
                  - $ref: "#/components/schemas/PaginatedCategories"

  /cities:
    get:
      tags: [Cities]
      summary: List cities
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Sort"
      responses:
        "200":
          description: City list
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/City"
                  - $ref: "#/components/schemas/PaginatedCities"

  /flowers:
    get:
      tags: [Flowers]
      summary: List flowers with filtering, sorting, pagination
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Sort"
        - $ref: "#/components/parameters/Fields"
        - name: q
          in: query
          schema:
            type: string
          description: Search by name or description
        - name: categoryId
          in: query
          schema:
            type: string
        - name: floristId
          in: query
          schema:
            type: string
        - name: city
          in: query
          schema:
            type: string
        - name: available
          in: query
          schema:
            type: boolean
        - name: minPrice
          in: query
          schema:
            type: number
        - name: maxPrice
          in: query
          schema:
            type: number
      responses:
        "200":
          description: Flower list
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/Flower"
                  - $ref: "#/components/schemas/PaginatedFlowers"

  /orders:
    get:
      tags: [Orders]
      summary: List orders
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Sort"
        - name: status
          in: query
          schema:
            type: string
        - name: userId
          in: query
          schema:
            type: string
        - name: floristId
          in: query
          schema:
            type: string
        - name: deliverId
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Order list
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/Order"
                  - $ref: "#/components/schemas/PaginatedOrders"

  /promotions:
    get:
      tags: [Promotions]
      summary: List promotions
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Sort"
        - name: all
          in: query
          schema:
            type: boolean
          description: Include inactive promotions when true
      responses:
        "200":
          description: Promotion list
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/Promotion"
                  - $ref: "#/components/schemas/PaginatedPromotions"

  /users:
    get:
      tags: [Users]
      summary: List users with role=user
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Sort"
      responses:
        "200":
          description: User list
          content:
            application/json:
              schema:
                oneOf:
                  - type: array
                    items:
                      $ref: "#/components/schemas/User"
                  - $ref: "#/components/schemas/PaginatedUsers"

components:
  parameters:
    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
      description: Page number (enables pagination when provided)
    Limit:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
      description: Page size (enables pagination when provided)
    Sort:
      name: sort
      in: query
      schema:
        type: string
      description: Comma-separated fields, prefix with '-' for desc (e.g. createdAt,-price)
    Fields:
      name: fields
      in: query
      schema:
        type: string
      description: Comma-separated fields to include

  schemas:
    Error:
      type: object
      properties:
        message:
          type: string

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        pages:
          type: integer

    RegisterRequest:
      type: object
      required: [name, email, password]
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string
        role:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string

    LoginResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: "#/components/schemas/User"

    User:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        email:
          type: string
        role:
          type: string
        city:
          type: string
        phone:
          type: string

    Category:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string

    City:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string

    Flower:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        price:
          type: number
        description:
          type: string
        image_url:
          type: string
        available:
          type: boolean
        categoryId:
          type: string
        floristId:
          type: string
        city:
          type: string

    Order:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        floristId:
          type: string
        deliverId:
          type: string
        status:
          type: string
        totalPrice:
          type: number
        city:
          type: string

    Promotion:
      type: object
      properties:
        _id:
          type: string
        title:
          type: string
        subtitle:
          type: string
        imageUrl:
          type: string
        isActive:
          type: boolean
        sortOrder:
          type: number

    PaginatedCategories:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Category"
        pagination:
          $ref: "#/components/schemas/Pagination"

    PaginatedCities:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/City"
        pagination:
          $ref: "#/components/schemas/Pagination"

    PaginatedFlowers:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Flower"
        pagination:
          $ref: "#/components/schemas/Pagination"

    PaginatedOrders:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Order"
        pagination:
          $ref: "#/components/schemas/Pagination"

    PaginatedPromotions:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Promotion"
        pagination:
          $ref: "#/components/schemas/Pagination"

    PaginatedUsers:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/User"
        pagination:
          $ref: "#/components/schemas/Pagination"
